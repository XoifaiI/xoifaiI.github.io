<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-encryption/aead" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">ChaCha20 Poly1305 (AEAD) | rbx-cryptography</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://xoifail.github.io/img/social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://xoifail.github.io/img/social-card.jpg"><meta data-rh="true" property="og:url" content="https://xoifail.github.io/docs/encryption/aead"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="ChaCha20 Poly1305 (AEAD) | rbx-cryptography"><meta data-rh="true" name="description" content="This is what you should use for symmetric encryption. It is authenticated encryption with associated data (AEAD), meaning tampered ciphertext will fail to decrypt. You get confidentiality and integrity in one package."><meta data-rh="true" property="og:description" content="This is what you should use for symmetric encryption. It is authenticated encryption with associated data (AEAD), meaning tampered ciphertext will fail to decrypt. You get confidentiality and integrity in one package."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://xoifail.github.io/docs/encryption/aead"><link data-rh="true" rel="alternate" href="https://xoifail.github.io/docs/encryption/aead" hreflang="en"><link data-rh="true" rel="alternate" href="https://xoifail.github.io/docs/encryption/aead" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Encryption","item":"https://xoifail.github.io/docs/category/encryption"},{"@type":"ListItem","position":2,"name":"ChaCha20 Poly1305 (AEAD)","item":"https://xoifail.github.io/docs/encryption/aead"}]}</script><link rel="stylesheet" href="/assets/css/styles.b475052b.css">
<script src="/assets/js/runtime~main.7f7387bc.js" defer="defer"></script>
<script src="/assets/js/main.c95106d3.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><b class="navbar__title text--truncate">rbx-cryptography</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/intro">Docs</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/daily3014/rbx-cryptography" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input searchInput_YFbd" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro"><span title="Introduction" class="linkLabel_WmDU">Introduction</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/best-practices"><span title="Security Best Practices" class="linkLabel_WmDU">Security Best Practices</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/docs/category/hashing"><span title="Hashing" class="categoryLinkLabel_W154">Hashing</span></a><button aria-label="Expand sidebar category &#x27;Hashing&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" href="/docs/category/encryption"><span title="Encryption" class="categoryLinkLabel_W154">Encryption</span></a><button aria-label="Collapse sidebar category &#x27;Encryption&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/encryption/aead"><span title="ChaCha20 Poly1305 (AEAD)" class="linkLabel_WmDU">ChaCha20 Poly1305 (AEAD)</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/encryption/aes"><span title="AES GCM" class="linkLabel_WmDU">AES GCM</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/encryption/lightweight"><span title="Lightweight Ciphers" class="linkLabel_WmDU">Lightweight Ciphers</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/docs/category/signatures-and-key-exchange"><span title="Signatures and Key Exchange" class="categoryLinkLabel_W154">Signatures and Key Exchange</span></a><button aria-label="Expand sidebar category &#x27;Signatures and Key Exchange&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/docs/category/utilities"><span title="Utilities" class="categoryLinkLabel_W154">Utilities</span></a><button aria-label="Expand sidebar category &#x27;Utilities&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/docs/category/encryption"><span>Encryption</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">ChaCha20 Poly1305 (AEAD)</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>ChaCha20 Poly1305 (AEAD)</h1></header>
<p>This is what you should use for symmetric encryption. It is authenticated encryption with associated data (AEAD), meaning tampered ciphertext will fail to decrypt. You get confidentiality and integrity in one package.</p>
<div class="language-luau codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-luau codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> AEAD </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Cryptography</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Encryption</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">AEAD</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="encrypt">Encrypt<a href="#encrypt" class="hash-link" aria-label="Direct link to Encrypt" title="Direct link to Encrypt" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="aeadencryptmessage-buffer-key-buffer-nonce-buffer-aad-buffer-rounds-number-usexchacha20-boolean---buffer-buffer"><code>AEAD.Encrypt(Message: buffer, Key: buffer, Nonce: buffer, AAD: buffer?, Rounds: number?, UseXChaCha20: boolean?) -&gt; (buffer, buffer)</code><a href="#aeadencryptmessage-buffer-key-buffer-nonce-buffer-aad-buffer-rounds-number-usexchacha20-boolean---buffer-buffer" class="hash-link" aria-label="Direct link to aeadencryptmessage-buffer-key-buffer-nonce-buffer-aad-buffer-rounds-number-usexchacha20-boolean---buffer-buffer" title="Direct link to aeadencryptmessage-buffer-key-buffer-nonce-buffer-aad-buffer-rounds-number-usexchacha20-boolean---buffer-buffer" translate="no">​</a></h3>
<p>Encrypts data and returns ciphertext plus a 16 byte authentication tag.</p>
<table><thead><tr><th>Parameter</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>Message</td><td>buffer</td><td>Data to encrypt</td></tr><tr><td>Key</td><td>buffer</td><td>32 bytes, use <code>CSPRNG.RandomBytes(32)</code></td></tr><tr><td>Nonce</td><td>buffer</td><td>12 bytes for ChaCha20, 24 bytes for XChaCha20</td></tr><tr><td>AAD</td><td>buffer?</td><td>Additional authenticated data (optional)</td></tr><tr><td>Rounds</td><td>number?</td><td>Default 20, can use 12 or 8 for speed</td></tr><tr><td>UseXChaCha20</td><td>boolean?</td><td>Use extended nonce variant</td></tr></tbody></table>
<div class="language-luau codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-luau codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> Key </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> CSPRNG</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">RandomBytes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">32</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> Nonce </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> CSPRNG</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">RandomBytes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">12</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> Plaintext </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> buffer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">fromstring</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Secret message&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- Basic encryption</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> Ciphertext</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Tag </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> AEAD</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Encrypt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Plaintext</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Nonce</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- With additional authenticated data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> AAD </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> buffer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">fromstring</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;user:alice,timestamp:12345&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> Ciphertext2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Tag2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> AEAD</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Encrypt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Plaintext</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Nonce</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> AAD</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>The AAD is authenticated but not encrypted. Use it for metadata you want to verify (like headers or routing info) but do not need to hide.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="decrypt">Decrypt<a href="#decrypt" class="hash-link" aria-label="Direct link to Decrypt" title="Direct link to Decrypt" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="aeaddecryptciphertext-buffer-key-buffer-nonce-buffer-tag-buffer-aad-buffer-rounds-number-usexchacha20-boolean---buffer"><code>AEAD.Decrypt(Ciphertext: buffer, Key: buffer, Nonce: buffer, Tag: buffer, AAD: buffer?, Rounds: number?, UseXChaCha20: boolean?) -&gt; buffer?</code><a href="#aeaddecryptciphertext-buffer-key-buffer-nonce-buffer-tag-buffer-aad-buffer-rounds-number-usexchacha20-boolean---buffer" class="hash-link" aria-label="Direct link to aeaddecryptciphertext-buffer-key-buffer-nonce-buffer-tag-buffer-aad-buffer-rounds-number-usexchacha20-boolean---buffer" title="Direct link to aeaddecryptciphertext-buffer-key-buffer-nonce-buffer-tag-buffer-aad-buffer-rounds-number-usexchacha20-boolean---buffer" translate="no">​</a></h3>
<p>Decrypts and verifies. Returns <code>nil</code> if authentication fails.</p>
<div class="language-luau codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-luau codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> Decrypted </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> AEAD</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Decrypt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Ciphertext</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Nonce</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Tag</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> AAD</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> Decrypted </span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Decrypted:&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> buffer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">tostring</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Decrypted</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">warn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Authentication failed, data was tampered&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><br></span></code></pre></div></div>
<!-- -->
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>Always Check for nil</div><div class="admonitionContent_BuS1"><p>If <code>Decrypt</code> returns <code>nil</code>, the ciphertext was modified or the wrong key/nonce was used. Never try to use the data.</p></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="xchacha20-mode">XChaCha20 Mode<a href="#xchacha20-mode" class="hash-link" aria-label="Direct link to XChaCha20 Mode" title="Direct link to XChaCha20 Mode" translate="no">​</a></h2>
<p>Standard ChaCha20 uses a 96 bit nonce, which has a birthday bound around 2^32 messages with the same key. If you are encrypting a lot of messages or want to use random nonces without worrying, use XChaCha20 with its 192 bit nonce:</p>
<div class="language-luau codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-luau codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> Key </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> CSPRNG</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">RandomBytes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">32</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> Nonce </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> CSPRNG</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">RandomBytes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">24</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- 24 bytes for XChaCha20</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> Ciphertext</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Tag </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> AEAD</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Encrypt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Plaintext</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Nonce</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">nil</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">nil</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> Decrypted </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> AEAD</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Decrypt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Ciphertext</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Nonce</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Tag</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">nil</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">nil</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">true</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>XChaCha20 uses HChaCha20 to derive a subkey from the first 128 bits of the nonce, giving you essentially unlimited messages per key without birthday concerns.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="reduced-rounds">Reduced Rounds<a href="#reduced-rounds" class="hash-link" aria-label="Direct link to Reduced Rounds" title="Direct link to Reduced Rounds" translate="no">​</a></h2>
<p>The default 20 rounds provide a large security margin. If you need more speed and can accept a smaller margin:</p>
<div class="language-luau codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-luau codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">-- 12 rounds (ChaCha12), still considered secure</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> Ciphertext</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Tag </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> AEAD</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Encrypt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Plaintext</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Nonce</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">nil</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">12</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- 8 rounds (ChaCha8), minimal security margin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> Ciphertext</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Tag </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> AEAD</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Encrypt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Plaintext</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Nonce</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">nil</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>For most applications, stick with 20 rounds. The performance difference in Luau is not dramatic enough to justify reduced security margin.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="raw-stream-ciphers">Raw Stream Ciphers<a href="#raw-stream-ciphers" class="hash-link" aria-label="Direct link to Raw Stream Ciphers" title="Direct link to Raw Stream Ciphers" translate="no">​</a></h2>
<p>If you need just the stream cipher without Poly1305 authentication:</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="aeadchacha20data-buffer-key-buffer-nonce-buffer-counter-number-rounds-number---buffer"><code>AEAD.ChaCha20(Data: buffer, Key: buffer, Nonce: buffer, Counter: number?, Rounds: number?) -&gt; buffer</code><a href="#aeadchacha20data-buffer-key-buffer-nonce-buffer-counter-number-rounds-number---buffer" class="hash-link" aria-label="Direct link to aeadchacha20data-buffer-key-buffer-nonce-buffer-counter-number-rounds-number---buffer" title="Direct link to aeadchacha20data-buffer-key-buffer-nonce-buffer-counter-number-rounds-number---buffer" translate="no">​</a></h3>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="aeadxchacha20data-buffer-key-buffer-nonce-buffer-counter-number-rounds-number---buffer"><code>AEAD.XChaCha20(Data: buffer, Key: buffer, Nonce: buffer, Counter: number?, Rounds: number?) -&gt; buffer</code><a href="#aeadxchacha20data-buffer-key-buffer-nonce-buffer-counter-number-rounds-number---buffer" class="hash-link" aria-label="Direct link to aeadxchacha20data-buffer-key-buffer-nonce-buffer-counter-number-rounds-number---buffer" title="Direct link to aeadxchacha20data-buffer-key-buffer-nonce-buffer-counter-number-rounds-number---buffer" translate="no">​</a></h3>
<div class="language-luau codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-luau codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> Encrypted </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> AEAD</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">ChaCha20</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Nonce</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">20</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> Decrypted </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> AEAD</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">ChaCha20</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Encrypted</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Nonce</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">20</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-danger admonition_xJq3 alert alert--danger"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>No Authentication</div><div class="admonitionContent_BuS1"><p>These raw functions do not authenticate. An attacker can flip bits in your ciphertext and you will not know. Only use these if you have a separate authentication mechanism.</p></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="security-properties">Security Properties<a href="#security-properties" class="hash-link" aria-label="Direct link to Security Properties" title="Direct link to Security Properties" translate="no">​</a></h2>
<p><strong>What AEAD gives you:</strong></p>
<ul>
<li class="">Confidentiality: attacker cannot read the plaintext</li>
<li class="">Integrity: attacker cannot modify ciphertext without detection</li>
<li class="">Authenticity: ciphertext was created by someone with the key</li>
</ul>
<p><strong>What AEAD does not give you:</strong></p>
<p><strong>Key commitment</strong> The same ciphertext can potentially decrypt to different plaintexts under different keys. This matters in multi key scenarios where an attacker might try to find a key that decrypts malicious content to something benign (Invisible Salamander attack). If this is a concern, include a hash of the key in your AAD.</p>
<p><strong>Nonce misuse resistance</strong> Reusing a nonce with the same key is catastrophic. It leaks the XOR of plaintexts and breaks authentication. Use random nonces with XChaCha20 if you cannot guarantee uniqueness.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_WFHX"><a href="https://github.com/daily3014/rbx-cryptography/tree/main/docs/docs/encryption/aead.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/category/encryption"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Encryption</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/encryption/aes"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">AES GCM</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#encrypt" class="table-of-contents__link toc-highlight">Encrypt</a><ul><li><a href="#aeadencryptmessage-buffer-key-buffer-nonce-buffer-aad-buffer-rounds-number-usexchacha20-boolean---buffer-buffer" class="table-of-contents__link toc-highlight"><code>AEAD.Encrypt(Message: buffer, Key: buffer, Nonce: buffer, AAD: buffer?, Rounds: number?, UseXChaCha20: boolean?) -&gt; (buffer, buffer)</code></a></li></ul></li><li><a href="#decrypt" class="table-of-contents__link toc-highlight">Decrypt</a><ul><li><a href="#aeaddecryptciphertext-buffer-key-buffer-nonce-buffer-tag-buffer-aad-buffer-rounds-number-usexchacha20-boolean---buffer" class="table-of-contents__link toc-highlight"><code>AEAD.Decrypt(Ciphertext: buffer, Key: buffer, Nonce: buffer, Tag: buffer, AAD: buffer?, Rounds: number?, UseXChaCha20: boolean?) -&gt; buffer?</code></a></li></ul></li><li><a href="#xchacha20-mode" class="table-of-contents__link toc-highlight">XChaCha20 Mode</a></li><li><a href="#reduced-rounds" class="table-of-contents__link toc-highlight">Reduced Rounds</a></li><li><a href="#raw-stream-ciphers" class="table-of-contents__link toc-highlight">Raw Stream Ciphers</a><ul><li><a href="#aeadchacha20data-buffer-key-buffer-nonce-buffer-counter-number-rounds-number---buffer" class="table-of-contents__link toc-highlight"><code>AEAD.ChaCha20(Data: buffer, Key: buffer, Nonce: buffer, Counter: number?, Rounds: number?) -&gt; buffer</code></a></li><li><a href="#aeadxchacha20data-buffer-key-buffer-nonce-buffer-counter-number-rounds-number---buffer" class="table-of-contents__link toc-highlight"><code>AEAD.XChaCha20(Data: buffer, Key: buffer, Nonce: buffer, Counter: number?, Rounds: number?) -&gt; buffer</code></a></li></ul></li><li><a href="#security-properties" class="table-of-contents__link toc-highlight">Security Properties</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/best-practices">Best Practices</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/daily3014/rbx-cryptography" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://wally.run/package/daily3014/cryptography" target="_blank" rel="noopener noreferrer" class="footer__link-item">Wally<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2026 daily3014. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>