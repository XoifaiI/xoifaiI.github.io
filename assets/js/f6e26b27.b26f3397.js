"use strict";(globalThis.webpackChunkrbx_cryptography_docs=globalThis.webpackChunkrbx_cryptography_docs||[]).push([[4043],{1708(e,n,r){r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>d,default:()=>u,frontMatter:()=>t,metadata:()=>o,toc:()=>l});const o=JSON.parse('{"id":"utilities/csprng","title":"CSPRNG","description":"Cryptographically Secure Pseudo Random Number Generator. Use this for ALL cryptographic randomness. Never use math.random() for anything security related.","source":"@site/docs/utilities/csprng.md","sourceDirName":"utilities","slug":"/utilities/csprng","permalink":"/docs/utilities/csprng","draft":false,"unlisted":false,"editUrl":"https://github.com/daily3014/rbx-cryptography/tree/main/docs/docs/utilities/csprng.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"Utilities","permalink":"/docs/category/utilities"},"next":{"title":"Encoding and Conversions","permalink":"/docs/utilities/encoding"}}');var s=r(4848),i=r(8453);const t={sidebar_position:1},d="CSPRNG",a={},l=[{value:"Random Numbers",id:"random-numbers",level:2},{value:"<code>CSPRNG.Random() -&gt; number</code>",id:"csprngrandom---number",level:3},{value:"<code>CSPRNG.RandomInt(Min: number, Max: number?) -&gt; number</code>",id:"csprngrandomintmin-number-max-number---number",level:3},{value:"<code>CSPRNG.RandomNumber(Min: number, Max: number?) -&gt; number</code>",id:"csprngrandomnumbermin-number-max-number---number",level:3},{value:"Random Bytes",id:"random-bytes",level:2},{value:"<code>CSPRNG.RandomBytes(Count: number) -&gt; buffer</code>",id:"csprngrandombytescount-number---buffer",level:3},{value:"<code>CSPRNG.RandomHex(Length: number) -&gt; string</code>",id:"csprngrandomhexlength-number---string",level:3},{value:"<code>CSPRNG.RandomString(Length: number, AsBuffer: boolean?) -&gt; buffer | string</code>",id:"csprngrandomstringlength-number-asbuffer-boolean---buffer--string",level:3},{value:"Ed25519 Key Generation",id:"ed25519-key-generation",level:2},{value:"<code>CSPRNG.Ed25519Random() -&gt; buffer</code>",id:"csprnged25519random---buffer",level:3},{value:"<code>CSPRNG.Ed25519ClampedBytes(Input: buffer) -&gt; buffer</code>",id:"csprnged25519clampedbytesinput-buffer---buffer",level:3},{value:"Entropy Management",id:"entropy-management",level:2},{value:"<code>CSPRNG.Reseed(CustomEntropy: buffer?)</code>",id:"csprngreseedcustomentropy-buffer",level:3},{value:"<code>CSPRNG.AddEntropyProvider(ProviderFunction: () -&gt; buffer?)</code>",id:"csprngaddentropyproviderproviderfunction----buffer",level:3},{value:"<code>CSPRNG.RemoveEntropyProvider(ProviderFunction: () -&gt; buffer?)</code>",id:"csprngremoveentropyproviderproviderfunction----buffer",level:3},{value:"How It Works",id:"how-it-works",level:2},{value:"Security Notes",id:"security-notes",level:2}];function c(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"csprng",children:"CSPRNG"})}),"\n",(0,s.jsxs)(n.p,{children:["Cryptographically Secure Pseudo Random Number Generator. Use this for ALL cryptographic randomness. Never use ",(0,s.jsx)(n.code,{children:"math.random()"})," for anything security related."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-luau",children:"local CSPRNG = Cryptography.Utilities.CSPRNG\n"})}),"\n",(0,s.jsx)(n.h2,{id:"random-numbers",children:"Random Numbers"}),"\n",(0,s.jsx)(n.h3,{id:"csprngrandom---number",children:(0,s.jsx)(n.code,{children:"CSPRNG.Random() -> number"})}),"\n",(0,s.jsx)(n.p,{children:"Returns a random float between 0 (inclusive) and 1 (exclusive)."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-luau",children:"local RandomFloat = CSPRNG.Random()\nprint(RandomFloat) -- e.g., 0.7234891...\n"})}),"\n",(0,s.jsx)(n.h3,{id:"csprngrandomintmin-number-max-number---number",children:(0,s.jsx)(n.code,{children:"CSPRNG.RandomInt(Min: number, Max: number?) -> number"})}),"\n",(0,s.jsx)(n.p,{children:"Returns a random integer. If only one argument, returns 1 to Min."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-luau",children:"local DiceRoll = CSPRNG.RandomInt(1, 6)\nlocal Index = CSPRNG.RandomInt(100) -- 1 to 100\n"})}),"\n",(0,s.jsx)(n.h3,{id:"csprngrandomnumbermin-number-max-number---number",children:(0,s.jsx)(n.code,{children:"CSPRNG.RandomNumber(Min: number, Max: number?) -> number"})}),"\n",(0,s.jsx)(n.p,{children:"Returns a random float in range. If only one argument, returns 0 to Min."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-luau",children:"local Value = CSPRNG.RandomNumber(0.5, 10.5)\nlocal Normalized = CSPRNG.RandomNumber(1.0) -- 0 to 1\n"})}),"\n",(0,s.jsx)(n.h2,{id:"random-bytes",children:"Random Bytes"}),"\n",(0,s.jsx)(n.h3,{id:"csprngrandombytescount-number---buffer",children:(0,s.jsx)(n.code,{children:"CSPRNG.RandomBytes(Count: number) -> buffer"})}),"\n",(0,s.jsx)(n.p,{children:"The workhorse function. Returns Count cryptographically random bytes."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-luau",children:"local Key = CSPRNG.RandomBytes(32)      -- 256 bit key\nlocal Nonce = CSPRNG.RandomBytes(12)    -- 96 bit nonce\nlocal IV = CSPRNG.RandomBytes(16)       -- 128 bit IV\n"})}),"\n",(0,s.jsx)(n.p,{children:"Use this for generating keys, nonces, IVs, salts, and any other security sensitive random data."}),"\n",(0,s.jsx)(n.h3,{id:"csprngrandomhexlength-number---string",children:(0,s.jsx)(n.code,{children:"CSPRNG.RandomHex(Length: number) -> string"})}),"\n",(0,s.jsx)(n.p,{children:"Returns a hex string of the specified length."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-luau",children:'local HexToken = CSPRNG.RandomHex(32) -- 32 hex chars\nprint(HexToken) -- e.g., "a7f3c1d4e8b2..."\n'})}),"\n",(0,s.jsx)(n.h3,{id:"csprngrandomstringlength-number-asbuffer-boolean---buffer--string",children:(0,s.jsx)(n.code,{children:"CSPRNG.RandomString(Length: number, AsBuffer: boolean?) -> buffer | string"})}),"\n",(0,s.jsx)(n.p,{children:"Returns random alphanumeric characters."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-luau",children:"local Token = CSPRNG.RandomString(20) -- returns string\nlocal TokenBuffer = CSPRNG.RandomString(20, true) -- returns buffer\n"})}),"\n",(0,s.jsx)(n.h2,{id:"ed25519-key-generation",children:"Ed25519 Key Generation"}),"\n",(0,s.jsx)(n.h3,{id:"csprnged25519random---buffer",children:(0,s.jsx)(n.code,{children:"CSPRNG.Ed25519Random() -> buffer"})}),"\n",(0,s.jsx)(n.p,{children:"Generates a properly clamped 32 byte Ed25519 secret key."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-luau",children:"local SecretKey = CSPRNG.Ed25519Random()\nlocal PublicKey = EdDSA.PublicKey(SecretKey)\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Always use this instead of ",(0,s.jsx)(n.code,{children:"RandomBytes(32)"})," for Ed25519 keys. The clamping ensures the key is a valid scalar for the curve."]}),"\n",(0,s.jsx)(n.h3,{id:"csprnged25519clampedbytesinput-buffer---buffer",children:(0,s.jsx)(n.code,{children:"CSPRNG.Ed25519ClampedBytes(Input: buffer) -> buffer"})}),"\n",(0,s.jsx)(n.p,{children:"Clamps existing 32 bytes to valid Ed25519 format."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-luau",children:"local SomeBytes = CSPRNG.RandomBytes(32)\nlocal ClampedKey = CSPRNG.Ed25519ClampedBytes(SomeBytes)\n"})}),"\n",(0,s.jsx)(n.p,{children:"Clamping clears the lowest 3 bits, clears the highest bit, and sets the second highest bit. This ensures the scalar is in the right subgroup and has consistent bit length."}),"\n",(0,s.jsx)(n.h2,{id:"entropy-management",children:"Entropy Management"}),"\n",(0,s.jsx)(n.h3,{id:"csprngreseedcustomentropy-buffer",children:(0,s.jsx)(n.code,{children:"CSPRNG.Reseed(CustomEntropy: buffer?)"})}),"\n",(0,s.jsx)(n.p,{children:"Forces state regeneration with optional custom entropy."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-luau",children:"-- Reseed with system entropy only\nCSPRNG.Reseed()\n\n-- Add custom entropy\nlocal Entropy = buffer.create(8)\nbuffer.writef64(Entropy, 0, tick())\nCSPRNG.Reseed(Entropy)\n"})}),"\n",(0,s.jsx)(n.p,{children:"The CSPRNG auto reseeds periodically, but you can force a reseed if you want to mix in application specific entropy."}),"\n",(0,s.jsx)(n.h3,{id:"csprngaddentropyproviderproviderfunction----buffer",children:(0,s.jsx)(n.code,{children:"CSPRNG.AddEntropyProvider(ProviderFunction: () -> buffer?)"})}),"\n",(0,s.jsx)(n.p,{children:"Registers a function that provides additional entropy."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-luau",children:"local function GameEntropy()\n    local Buf = buffer.create(12)\n    buffer.writeu32(Buf, 0, PlayerCount)\n    buffer.writef64(Buf, 4, SomeUnpredictableGameState)\n    return Buf\nend\n\nCSPRNG.AddEntropyProvider(GameEntropy)\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Provider functions are called during reseeding. They should return fresh entropy each time or ",(0,s.jsx)(n.code,{children:"nil"})," if nothing new is available."]}),"\n",(0,s.jsx)(n.h3,{id:"csprngremoveentropyproviderproviderfunction----buffer",children:(0,s.jsx)(n.code,{children:"CSPRNG.RemoveEntropyProvider(ProviderFunction: () -> buffer?)"})}),"\n",(0,s.jsx)(n.p,{children:"Unregisters an entropy provider."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-luau",children:"CSPRNG.RemoveEntropyProvider(GameEntropy)\n"})}),"\n",(0,s.jsx)(n.h2,{id:"how-it-works",children:"How It Works"}),"\n",(0,s.jsx)(n.p,{children:"The CSPRNG uses ChaCha20 as a deterministic random bit generator (DRBG) with BLAKE3 for entropy mixing."}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Initialization"})," Gather entropy from available sources (tick, os.clock, os.time, math.random for initial seeding), mix entropy with BLAKE3 to derive the ChaCha20 key and nonce, generate initial random block."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Generation"})," Run ChaCha20 to produce 64 byte blocks, extract bytes as needed, when the block is exhausted increment counter and generate another."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Reseeding"})," Auto reseeds periodically, mixes fresh entropy with BLAKE3."]}),"\n",(0,s.jsx)(n.h2,{id:"security-notes",children:"Security Notes"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Do:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Use ",(0,s.jsx)(n.code,{children:"CSPRNG"})," for all cryptographic randomness"]}),"\n",(0,s.jsxs)(n.li,{children:["Use ",(0,s.jsx)(n.code,{children:"Ed25519Random()"})," for Ed25519 secret keys"]}),"\n",(0,s.jsx)(n.li,{children:"Consider adding application specific entropy via providers"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Do not:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Use ",(0,s.jsx)(n.code,{children:"math.random()"})," for keys, nonces, or anything security sensitive"]}),"\n",(0,s.jsx)(n.li,{children:"Assume CSPRNG output is truly random (it is pseudorandom, unless you use TrueRandom example)"}),"\n",(0,s.jsx)(n.li,{children:"Expose CSPRNG state or output directly to untrusted parties"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"The CSPRNG produces output computationally indistinguishable from random for anyone who does not know the internal state. The auto reseeding limits damage if state is ever found out."})]})}function u(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},8453(e,n,r){r.d(n,{R:()=>t,x:()=>d});var o=r(6540);const s={},i=o.createContext(s);function t(e){const n=o.useContext(i);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:t(e.components),o.createElement(i.Provider,{value:n},e.children)}}}]);